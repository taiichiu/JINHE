# 晉鶴內部管理系統規格文件（spec.zh.md）

📁 本文件為完整功能規格說明，供 GPT Agent 與開發團隊參考。

---

## 🟦 系統總覽與技術建議

- 本系統為 SPA（單頁式應用），支援桌機、平板與手機。
- 資料層使用 Firebase Firestore + Auth。
- 前端建議使用 React + Tailwind CSS。
- 所有資料異動必須記錄操作 log。
- 使用者介面須具備 loading / error 處理，API 不可造成卡死。
- 所有「預約、付款、報表」皆需防呆與重複檢查。

---

## 🔐 多角色權限控管

角色包含：
- 老闆
- 店長
- 業務
- 員工
- 櫃台

不同角色登入後看到的功能畫面不同，權限嚴格分層。

---

## 📅 功能模組細節

### 1. 預約 / 報到 / 服務指派

- 客戶來電時可查舊客戶，無資料則新增。
- 可指定服務項目與員工（可不指派）。
- 預約重複與員工滿檔時禁止送出。
- 報到後於行事曆標註狀態。
- 付款完成後鎖定資料，禁止修改。

📌 技術提醒：
- 所有查重以 Firestore 為準，禁止僅靠前端快取。
- 日曆與預約資料需雙向同步，處理時區。
- 異常請用 try-catch，UI 顯示錯誤。

---

### 2. 客戶資料表自訂（拖曳排序）

- 老闆可自訂表單欄位，無預設格式。
- 每欄可自由增刪、命名、排序。
- 新客戶畫面自動套用設定欄位。

📌 技術提醒：
- 拖曳建議用 react-beautiful-dnd 或 dnd-kit。
- Firestore 儲存排序結果時以整包覆蓋。
- 拖曳時欄位 id 不可變。

---

### 3. 員工排班 / 班表管理

- 店長可排每日班表。
- 預約不可超出員工上班時段。
- 行事曆應清楚區分排班與預約。
- 排班改動需即時更新可預約時段。

📌 技術提醒：
- 班表資料須存於 Firestore，前端僅顯示。
- 預約前需再次確認班表與時段無衝突。
- 排班中途 loading 不可立即開放預約。

---

### 4. 報到與付款鎖定

- 客戶報到後在行事曆中標記。
- 付款完成後須鎖定紀錄不可編輯或刪除。

📌 技術提醒：
- Firestore 加入 `locked: true` 欄位。
- 前端 disable 所有按鈕，後端 Firestore rules 也要限制。
- 所有異常操作需提示與備援。

---

### 5. 營運報表與 Pie Chart 分析

- Pie Chart 僅計算店長與員工的實際服務金額。
- 點選 Pie 可展開明細（日期、客戶、金額）。
- 業務明細不出現在 Pie，但要統計其推薦的客戶消費。
- 總營收不可重複計算（不重複加業務與員工）。

📌 技術提醒：
- 報表元件建議用 `recharts` 或 `nivo`。
- 數據來源以 Firestore 為準，不可快取或二次計算。
- 所有報表均可切換月份並匯出 Excel。

---

### 6. 欄位驗證規則

- 手機：`/^09\d{8}$/`
- Email：標準格式
- 生日：日期選擇器
- 性別：選單

📌 技術提醒：
- 使用 Yup 或 Zod + React Hook Form 驗證
- 所有驗證錯誤須即時顯示，不可送出
- 跨裝置需一致驗證規則

---

### 7. 登入與權限管理

- 採用 Firebase Auth
- 各角色的權限與名稱存放於 Firestore 的 `roles` collection
- 登入後自動判斷角色與權限

📌 技術提醒：
- 前端與 Firestore rules 均須同步檢查權限
- 切換帳號時須清除 context / cache
- 禁止未授權的元件出現在畫面上（防止誤觸）

---

## 🔧 通用開發建議

- 各頁面應分層（資料抓取 / 狀態管理 / UI 渲染）
- 所有資料異動都需留存 log
- 功能模組異步錯誤須明確提示
- SPA 必須處理 loading/error 狀態
- 定期整合測試，避免技術債堆積

---

## 🗂 文件版本資訊

- 文件版本：v1.0
- 最後更新：2025-07-25
- 原始需求來源：jinheprompt.txt
